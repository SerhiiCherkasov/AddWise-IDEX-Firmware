M290 R0 S0
G10 P0 R270 S270

M98 P"homeall.g" L1 Z1 S1
M290 R0 S0

if move.axes[2].machinePosition < 30
  G91
  G0 Z30
  G90

M98 R1 P"essential/attachedcheck.g" ; make sure probe is conected, pick if negative and leave relay active

T0
G90                 ; absolute positioning
G1 U{move.axes[3].max} F18000      ; Move second tool out of the way
G1 X{0 - sensors.probes[0].offsets[0]} Y{-150 - sensors.probes[0].offsets[1]} F18000
M98 R1 P"essential/attachedcheck.g" ; make sure probe is conected, pick if negative and leave relay active
M558 K0 P5 C"duex.e6stop" H5 F300 T18000
M98 P"essential/autogen/ProbeOffset.g"
G30			    	; Home bed using probe

M98 P"place.g"


T-1
T0

M83
G1 E-10 F{60}*{20}

M116 P0 S10
T-1
T0

G0 F18000 X0 Y-150 Z5

M208 Z-5 S1
M291 S3 P"Press ""OK"" to save new Z offset" Z1


set global.zoffset = global.zoffset - move.axes[2].machinePosition + {0.06}  ; Apply babystepping to zoffset

echo >"essential/autogen/ProbeOffset.g" "; THIS FILE IS AUTOGENERATED !" ; Generate ProbeOffset.g
echo >>"essential/autogen/ProbeOffset.g" "; Please edit contents of '/macros/Save Z offset'"
echo >>"essential/autogen/ProbeOffset.g" "; Set Z probe trigger value, offset and trigger height"
echo >>"essential/autogen/ProbeOffset.g" "G31 P500 X0 Y28.50"
echo >>"essential/autogen/ProbeOffset.g" "G31 Z"^{global.zoffset}
echo >>"essential/autogen/ProbeOffset.g" ""
echo >>"essential/autogen/ProbeOffset.g" ";When too Low => Subtract the difference"
echo >>"essential/autogen/ProbeOffset.g" ";When too High => Add the difference"
echo >"essential/autogen/zoffset.g" "; THIS FILE IS AUTOGENERATED !"  ; Generate zoffset.g (persistent zoffset var)
echo >>"essential/autogen/zoffset.g" "; Please edit contents of '/macros/Save Z offset'"
echo >>"essential/autogen/zoffset.g" "if exists(global.zoffset)"
echo >>"essential/autogen/zoffset.g" "  set global.zoffset = "^{global.zoffset}
echo >>"essential/autogen/zoffset.g" "else"
echo >>"essential/autogen/zoffset.g" "  global zoffset = "^{global.zoffset}; Reset babystepping to 0 to avoid accidentally adding offset second time


M208 Z0 S1
G10 P0 R0 S0
G10 P1 R0 S0
G10 P2 R0 S0
G10 P3 R0 S0

G0 F18000 Z20 Y150 X{move.axes[0].min} U{move.axes[3].max}